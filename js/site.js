var app={Collections:{},Models:{},Views:{}};app.Models.City=Backbone.Model.extend({defaults:{}}),app.Collections.Cities=Backbone.Collection.extend({model:app.Models.City}),app.Views.City=Backbone.View.extend({tagName:"li",className:"city",template:_.template($("#cityTemplate").html()),render:function(){return this.$el.html(this.template(this.model.toJSON())),this}}),app.Views.Cities=Backbone.View.extend({el:".cities",initialize:function(){this.collection=app.cities,this.render(),this.listenTo(this.collection,"add",this.render),this.listenTo(this.collection,"next",this.showNext),this.listenTo(this.collection,"previous",this.showPrevious)},render:function(){this.$el.html(""),this.collection.each(function(a){this.renderCity(a)},this)},renderCity:function(a){var b=new app.Views.City({model:a});this.$el.append(b.render().el)},showNext:function(){var a=Math.abs(parseInt(this.$el.css("left"),10)),b=a+370===0?0:"-"+(a+370)+"px";this.$el.animate({left:b},300)},showPrevious:function(){var a=Math.abs(parseInt(this.$el.css("left"),10)),b=a+370===0?0:"-"+(a-370)+"px";this.$el.animate({left:b},300)}}),app.Views.App=Backbone.View.extend({el:".app",initialize:function(){app.cities=new app.Collections.Cities,new app.Views.Cities},events:{"click button":"addCity","click .next":"nextCity","click .previous":"previousCity"},addCity:function(a){a.preventDefault();var b=this.$el.find("#search-city"),c=b.val(),d=escape("select item from weather.forecast where woeid in (select woeid from geo.places where text='"+c+"') and u='c'"),e="https://query.yahooapis.com/v1/public/yql?q="+d+"&format=json&callback=?";$.getJSON(e,function(a){if(a.query.count>0){var c,d=a.query.results.channel[0].item.title,e=a.query.results.channel[0].item.description,f=a.query.results.channel[0].item.forecast,g=(a.query.results.channel[0].item.forecast,f.length),h=[];for(c=0;g>c;c++)h.push({day:a.query.results.channel[0].item.forecast[c].day,high:a.query.results.channel[0].item.forecast[c].high,low:a.query.results.channel[0].item.forecast[c].low});app.cities.add({title:d,description:e,forecast:f,forecasts:h,tweetMessage:"The Temperature in "+d.split(" ")[2]+" will be between "+h[0].low+" and "+h[0].high+"C today."}),twttr.widgets.load(),b.val("").focus(),app.cities.length>1&&app.cities.trigger("next")}else console.log("Sorry no results found!")})},nextCity:function(a){a.preventDefault(),app.cities.trigger("next")},previousCity:function(a){a.preventDefault(),app.cities.trigger("previous")}}),new app.Views.App;